<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Technique - CERCLE PRIV√â</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a 0%, #1a237e 50%, #0d1b2a 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #d97706;
        }
        .logo {
            color: #d97706;
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 0.1em;
            margin-bottom: 10px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
            border-left: 4px solid;
        }
        .status.success { 
            background: rgba(34, 197, 94, 0.1); 
            color: #22c55e; 
            border-left-color: #22c55e; 
        }
        .status.warning { 
            background: rgba(245, 158, 11, 0.1); 
            color: #f59e0b; 
            border-left-color: #f59e0b; 
        }
        .status.error { 
            background: rgba(239, 68, 68, 0.1); 
            color: #ef4444; 
            border-left-color: #ef4444; 
        }
        .status.info { 
            background: rgba(59, 130, 246, 0.1); 
            color: #3b82f6; 
            border-left-color: #3b82f6; 
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .test-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .test-title::before {
            content: "üîç";
            margin-right: 10px;
        }
        .btn {
            background: #d97706;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { 
            background: #b45309; 
            transform: translateY(-2px);
        }
        .btn.secondary {
            background: #6b7280;
        }
        .btn.secondary:hover { 
            background: #4b5563; 
        }
        .btn.danger {
            background: #ef4444;
        }
        .btn.danger:hover { 
            background: #dc2626; 
        }
        .results {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #d97706, #f59e0b);
            transition: width 0.3s ease;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="logo">CERCLE PRIV√â</h1>
            <h2>Diagnostic Technique Avanc√©</h2>
            <p>Outil de diagnostic automatique pour r√©soudre les probl√®mes de page blanche</p>
        </div>

        <!-- √âtat g√©n√©ral -->
        <div class="test-section">
            <div class="test-title">√âtat G√©n√©ral du Syst√®me</div>
            <div id="general-status">
                <div class="status info">üîÑ Initialisation du diagnostic...</div>
            </div>
            <button class="btn" onclick="runComprehensiveDiagnostic()">üîç Diagnostic Complet</button>
            <button class="btn secondary" onclick="runQuickFix()">üîß R√©paration Rapide</button>
        </div>

        <!-- Tests sp√©cifiques -->
        <div class="test-section">
            <div class="test-title">Tests Sp√©cialis√©s</div>
            <div class="grid">
                <button class="btn" onclick="testReactMounting()">‚öõÔ∏è Test React</button>
                <button class="btn" onclick="testSupabaseConnection()">üóÑÔ∏è Test Supabase</button>
                <button class="btn" onclick="testUserSession()">üë§ Test Session</button>
                <button class="btn" onclick="testResourceLoading()">üì¶ Test Ressources</button>
            </div>
            <div id="specialized-results"></div>
        </div>

        <!-- R√©parations automatiques -->
        <div class="test-section">
            <div class="test-title">R√©parations Automatiques</div>
            <div id="auto-fix-results"></div>
            <div class="grid">
                <button class="btn" onclick="clearCorruptedData()">üßπ Nettoyer Donn√©es</button>
                <button class="btn" onclick="resetUserSession()">üîÑ Reset Session</button>
                <button class="btn" onclick="clearAllCaches()">üíæ Vider Caches</button>
                <button class="btn danger" onclick="emergencyReset()">üö® Reset Complet</button>
            </div>
        </div>

        <!-- Informations syst√®me -->
        <div class="test-section">
            <div class="test-title">Informations Syst√®me</div>
            <div id="system-info"></div>
        </div>

        <!-- Actions de r√©cup√©ration -->
        <div class="test-section">
            <div class="test-title">Actions de R√©cup√©ration</div>
            <div class="grid">
                <a href="/" class="btn">üè† Retour Accueil</a>
                <a href="/debug-check.html" class="btn secondary">üîß Page Test</a>
                <button class="btn" onclick="exportDiagnosticData()">üìã Exporter Rapport</button>
                <a href="mailto:nicolas.c@lacremerie.fr?subject=Probl√®me technique CERCLE PRIV√â" class="btn">üìß Contacter Support</a>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour le diagnostic
        let diagnosticData = {
            errors: [],
            warnings: [],
            fixes: [],
            systemInfo: {},
            timestamp: new Date().toISOString()
        };

        // Initialiser les informations syst√®me
        function initializeSystemInfo() {
            const info = {
                userAgent: navigator.userAgent,
                url: window.location.href,
                protocol: window.location.protocol,
                host: window.location.host,
                viewport: `${window.innerWidth} √ó ${window.innerHeight}`,
                localStorage: typeof Storage !== 'undefined',
                serviceWorker: 'serviceWorker' in navigator,
                online: navigator.onLine,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                javaScriptEnabled: true,
                timestamp: new Date().toLocaleString('fr-FR')
            };

            diagnosticData.systemInfo = info;

            document.getElementById('system-info').innerHTML = `
                <div class="results">
Browser: ${info.userAgent.split(' ')[0]}
URL: ${info.url}
Protocol: ${info.protocol}
Host: ${info.host}
Viewport: ${info.viewport}
LocalStorage: ${info.localStorage ? '‚úÖ Disponible' : '‚ùå Non disponible'}
Service Worker: ${info.serviceWorker ? '‚úÖ Support√©' : '‚ùå Non support√©'}
Connexion: ${info.online ? '‚úÖ En ligne' : '‚ùå Hors ligne'}
Langue: ${info.language}
Cookies: ${info.cookieEnabled ? '‚úÖ Activ√©s' : '‚ùå D√©sactiv√©s'}
JavaScript: ‚úÖ Activ√©
Derni√®re v√©rification: ${info.timestamp}
                </div>
            `;
        }

        // 1. Diagnostic complet
        async function runComprehensiveDiagnostic() {
            const statusDiv = document.getElementById('general-status');
            statusDiv.innerHTML = '<div class="status info">üîÑ Diagnostic complet en cours...</div>';

            try {
                let html = '';
                let criticalIssues = 0;

                // Test 1: Structure HTML/DOM
                const rootElement = document.getElementById('root');
                const hasRoot = !!rootElement;
                const hasContent = rootElement && rootElement.children.length > 0;
                
                if (!hasRoot) {
                    html += '<div class="status error">‚ùå √âl√©ment #root manquant dans le DOM</div>';
                    criticalIssues++;
                } else if (!hasContent) {
                    html += '<div class="status warning">‚ö†Ô∏è √âl√©ment #root vide - React non mont√©</div>';
                    criticalIssues++;
                } else {
                    html += '<div class="status success">‚úÖ Structure DOM correcte</div>';
                }

                // Test 2: JavaScript et React
                const reactLoaded = typeof React !== 'undefined';
                if (!reactLoaded) {
                    html += '<div class="status error">‚ùå React non charg√©</div>';
                    criticalIssues++;
                } else {
                    html += '<div class="status success">‚úÖ React charg√© correctement</div>';
                }

                // Test 3: CSS et styles
                const stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
                const cssLoaded = stylesheets.length > 0;
                if (!cssLoaded) {
                    html += '<div class="status warning">‚ö†Ô∏è Aucune feuille de style d√©tect√©e</div>';
                } else {
                    html += '<div class="status success">‚úÖ Feuilles de style charg√©es (${stylesheets.length})</div>';
                }

                // Test 4: LocalStorage et donn√©es utilisateur
                const userLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
                const userData = localStorage.getItem('userData');
                
                if (!userLoggedIn) {
                    html += '<div class="status warning">‚ö†Ô∏è Utilisateur non connect√©</div>';
                } else if (!userData) {
                    html += '<div class="status warning">‚ö†Ô∏è Donn√©es utilisateur manquantes</div>';
                } else {
                    html += '<div class="status success">‚úÖ Session utilisateur valide</div>';
                }

                // Test 5: Erreurs JavaScript
                const errorLog = localStorage.getItem('errorLog');
                const errors = errorLog ? JSON.parse(errorLog) : [];
                
                if (errors.length > 0) {
                    html += `<div class="status error">‚ùå ${errors.length} erreur(s) JavaScript d√©tect√©e(s)</div>`;
                    criticalIssues++;
                } else {
                    html += '<div class="status success">‚úÖ Aucune erreur JavaScript</div>';
                }

                // Test 6: Connexion r√©seau
                if (!navigator.onLine) {
                    html += '<div class="status error">‚ùå Pas de connexion internet</div>';
                    criticalIssues++;
                } else {
                    html += '<div class="status success">‚úÖ Connexion internet active</div>';
                }

                // R√©sum√© final
                if (criticalIssues === 0) {
                    html += '<div class="status success">üéâ Aucun probl√®me critique d√©tect√©</div>';
                } else {
                    html += `<div class="status error">‚ö†Ô∏è ${criticalIssues} probl√®me(s) critique(s) d√©tect√©(s)</div>`;
                }

                statusDiv.innerHTML = html;
                diagnosticData.errors = errors;

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Erreur lors du diagnostic : ${error.message}</div>`;
                diagnosticData.errors.push(`Comprehensive diagnostic: ${error.message}`);
            }
        }

        // 2. Test React sp√©cifique
        function testReactMounting() {
            const resultsDiv = document.getElementById('specialized-results');
            
            try {
                const rootElement = document.getElementById('root');
                let html = '';

                if (!rootElement) {
                    html += '<div class="status error">‚ùå √âl√©ment #root introuvable</div>';
                } else {
                    html += '<div class="status success">‚úÖ √âl√©ment #root trouv√©</div>';
                    
                    const hasChildren = rootElement.children.length > 0;
                    if (!hasChildren) {
                        html += '<div class="status error">‚ùå React non mont√© - #root vide</div>';
                        html += '<div class="status info">üí° Solution: V√©rifier les erreurs JavaScript et recharger</div>';
                    } else {
                        html += `<div class="status success">‚úÖ React mont√© avec ${rootElement.children.length} √©l√©ment(s)</div>';
                    }
                }

                // V√©rifier les scripts React
                const reactScripts = document.querySelectorAll('script[src*="react"]');
                if (reactScripts.length === 0) {
                    html += '<div class="status warning">‚ö†Ô∏è Scripts React non d√©tect√©s</div>';
                } else {
                    html += `<div class="status success">‚úÖ ${reactScripts.length} script(s) React charg√©(s)</div>';
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur test React : ${error.message}</div>`;
            }
        }

        // 3. Test Supabase
        async function testSupabaseConnection() {
            const resultsDiv = document.getElementById('specialized-results');
            resultsDiv.innerHTML = '<div class="status info">üîÑ Test de connexion Supabase...</div>';

            try {
                // V√©rifier les variables d'environnement
                const supabaseUrl = 'https://your-project.supabase.co'; // Remplacez par votre URL
                const supabaseKey = 'your-anon-key'; // Remplacez par votre cl√©
                
                let html = '';

                if (supabaseUrl === 'https://your-project.supabase.co') {
                    html += '<div class="status warning">‚ö†Ô∏è Supabase non configur√© - utilisation du mode local</div>';
                } else {
                    try {
                        const response = await fetch(`${supabaseUrl}/rest/v1/`, {
                            headers: {
                                'apikey': supabaseKey,
                                'Authorization': `Bearer ${supabaseKey}`
                            }
                        });
                        
                        if (response.ok) {
                            html += '<div class="status success">‚úÖ Connexion Supabase r√©ussie</div>';
                        } else {
                            html += `<div class="status error">‚ùå Erreur Supabase: ${response.status}</div>`;
                        }
                    } catch (error) {
                        html += `<div class="status error">‚ùå Impossible de se connecter √† Supabase: ${error.message}</div>`;
                    }
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur test Supabase : ${error.message}</div>`;
            }
        }

        // 4. Test session utilisateur
        function testUserSession() {
            const resultsDiv = document.getElementById('specialized-results');
            
            try {
                let html = '';

                const userLoggedIn = localStorage.getItem('userLoggedIn');
                const userData = localStorage.getItem('userData');
                const adminLoggedIn = localStorage.getItem('adminLoggedIn');

                html += `<div class="status ${userLoggedIn === 'true' ? 'success' : 'warning'}">
                    ${userLoggedIn === 'true' ? '‚úÖ' : '‚ö†Ô∏è'} Statut utilisateur: ${userLoggedIn || 'non d√©fini'}
                </div>`;

                if (userData) {
                    try {
                        const user = JSON.parse(userData);
                        html += `<div class="status success">‚úÖ Donn√©es utilisateur valides: ${user.prenom} ${user.nom}</div>`;
                    } catch {
                        html += '<div class="status error">‚ùå Donn√©es utilisateur corrompues</div>';
                    }
                } else {
                    html += '<div class="status warning">‚ö†Ô∏è Aucune donn√©e utilisateur</div>';
                }

                html += `<div class="status ${adminLoggedIn === 'true' ? 'success' : 'info'}">
                    ${adminLoggedIn === 'true' ? '‚úÖ' : '‚ÑπÔ∏è'} Statut admin: ${adminLoggedIn || 'non d√©fini'}
                </div>`;

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur test session : ${error.message}</div>`;
            }
        }

        // 5. Test chargement des ressources
        async function testResourceLoading() {
            const resultsDiv = document.getElementById('specialized-results');
            resultsDiv.innerHTML = '<div class="status info">üîÑ Test des ressources...</div>';

            try {
                const criticalResources = [
                    { name: 'Manifest PWA', url: '/manifest.json' },
                    { name: 'Service Worker', url: '/sw.js' },
                    { name: 'Ic√¥ne 192', url: '/icon-192.png' },
                    { name: 'Ic√¥ne 512', url: '/icon-512.png' }
                ];

                let html = '';
                let failedResources = 0;

                for (const resource of criticalResources) {
                    try {
                        const response = await fetch(resource.url, { method: 'HEAD' });
                        if (response.ok) {
                            html += `<div class="status success">‚úÖ ${resource.name}: OK (${response.status})</div>`;
                        } else {
                            html += `<div class="status warning">‚ö†Ô∏è ${resource.name}: ${response.status}</div>`;
                            failedResources++;
                        }
                    } catch (error) {
                        html += `<div class="status error">‚ùå ${resource.name}: √âchec</div>`;
                        failedResources++;
                    }
                }

                if (failedResources === 0) {
                    html += '<div class="status success">üéâ Toutes les ressources sont accessibles</div>';
                } else {
                    html += `<div class="status warning">‚ö†Ô∏è ${failedResources} ressource(s) inaccessible(s)</div>`;
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur test ressources : ${error.message}</div>`;
            }
        }

        // 6. R√©paration rapide
        async function runQuickFix() {
            const statusDiv = document.getElementById('general-status');
            statusDiv.innerHTML = '<div class="status info">üîß R√©paration rapide en cours...</div>';

            try {
                let fixes = [];
                let html = '';

                // Fix 1: Nettoyer les donn√©es corrompues
                let corruptedKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key) {
                        try {
                            const value = localStorage.getItem(key);
                            if (value && value.startsWith('{')) {
                                JSON.parse(value);
                            }
                        } catch (e) {
                            corruptedKeys.push(key);
                        }
                    }
                }

                if (corruptedKeys.length > 0) {
                    corruptedKeys.forEach(key => localStorage.removeItem(key));
                    fixes.push(`Supprim√© ${corruptedKeys.length} donn√©e(s) corrompue(s)`);
                    html += `<div class="status success">‚úÖ ${corruptedKeys.length} donn√©e(s) corrompue(s) nettoy√©e(s)</div>`;
                }

                // Fix 2: V√©rifier et corriger la session utilisateur
                const userLoggedIn = localStorage.getItem('userLoggedIn');
                if (userLoggedIn === null) {
                    localStorage.setItem('userLoggedIn', 'false');
                    fixes.push('Statut de connexion r√©initialis√©');
                    html += '<div class="status success">‚úÖ Statut de connexion r√©initialis√©</div>';
                }

                // Fix 3: Nettoyer les caches obsol√®tes
                if ('caches' in window) {
                    try {
                        const cacheNames = await caches.keys();
                        const oldCaches = cacheNames.filter(name => !name.includes('v3'));
                        
                        for (const cacheName of oldCaches) {
                            await caches.delete(cacheName);
                        }
                        
                        if (oldCaches.length > 0) {
                            fixes.push(`Supprim√© ${oldCaches.length} cache(s) obsol√®te(s)`);
                            html += `<div class="status success">‚úÖ ${oldCaches.length} cache(s) obsol√®te(s) supprim√©(s)</div>`;
                        }
                    } catch (error) {
                        html += `<div class="status warning">‚ö†Ô∏è Erreur nettoyage cache: ${error.message}</div>`;
                    }
                }

                if (fixes.length === 0) {
                    html = '<div class="status success">‚úÖ Aucune r√©paration n√©cessaire - Le syst√®me fonctionne correctement</div>';
                } else {
                    html += `<div class="status success">üéâ ${fixes.length} r√©paration(s) appliqu√©e(s) avec succ√®s</div>`;
                    html += '<div class="status info">üîÑ Rechargement recommand√© pour appliquer les corrections</div>';
                }

                statusDiv.innerHTML = html;
                diagnosticData.fixes = fixes;

                // Proposer de recharger si des fixes ont √©t√© appliqu√©s
                if (fixes.length > 0) {
                    setTimeout(() => {
                        if (confirm('R√©parations appliqu√©es. Recharger la page maintenant ?')) {
                            window.location.reload();
                        }
                    }, 2000);
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Erreur r√©paration rapide : ${error.message}</div>`;
            }
        }

        // 7. Nettoyer les donn√©es corrompues
        function clearCorruptedData() {
            const resultsDiv = document.getElementById('auto-fix-results');
            
            try {
                let corruptedKeys = [];
                let html = '';

                // Identifier les cl√©s corrompues
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key) {
                        try {
                            const value = localStorage.getItem(key);
                            if (value && (value.startsWith('{') || value.startsWith('['))) {
                                JSON.parse(value);
                            }
                        } catch (e) {
                            corruptedKeys.push(key);
                        }
                    }
                }

                if (corruptedKeys.length > 0) {
                    corruptedKeys.forEach(key => localStorage.removeItem(key));
                    html += `<div class="status success">‚úÖ ${corruptedKeys.length} donn√©e(s) corrompue(s) supprim√©e(s)</div>`;
                    html += '<div class="results">Cl√©s supprim√©es:\n' + corruptedKeys.join('\n') + '</div>';
                } else {
                    html += '<div class="status success">‚úÖ Aucune donn√©e corrompue d√©tect√©e</div>';
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur nettoyage : ${error.message}</div>`;
            }
        }

        // 8. Reset session utilisateur
        function resetUserSession() {
            const resultsDiv = document.getElementById('auto-fix-results');
            
            try {
                // Sauvegarder les donn√©es importantes
                const importantData = {};
                const importantKeys = ['siteContent', 'properties', 'presentationImages'];
                
                importantKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) importantData[key] = value;
                });

                // Reset session
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('userData');
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('errorLog');

                // Restaurer les donn√©es importantes
                Object.entries(importantData).forEach(([key, value]) => {
                    localStorage.setItem(key, value);
                });

                let html = '<div class="status success">‚úÖ Session utilisateur r√©initialis√©e</div>';
                html += '<div class="status info">‚ÑπÔ∏è Donn√©es de contenu pr√©serv√©es</div>';
                html += '<div class="status warning">‚ö†Ô∏è Vous devrez vous reconnecter</div>';

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur reset session : ${error.message}</div>`;
            }
        }

        // 9. Vider tous les caches
        async function clearAllCaches() {
            const resultsDiv = document.getElementById('auto-fix-results');
            resultsDiv.innerHTML = '<div class="status info">üîÑ Nettoyage des caches...</div>';

            try {
                let html = '';

                // Vider les caches Service Worker
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                    }
                    html += `<div class="status success">‚úÖ ${cacheNames.length} cache(s) Service Worker supprim√©(s)</div>`;
                } else {
                    html += '<div class="status warning">‚ö†Ô∏è Service Worker non support√©</div>';
                }

                // Vider sessionStorage
                sessionStorage.clear();
                html += '<div class="status success">‚úÖ SessionStorage vid√©</div>';

                html += '<div class="status success">üéâ Nettoyage termin√©</div>';
                html += '<div class="status info">üîÑ Rechargement recommand√©</div>';

                resultsDiv.innerHTML = html;

                // Proposer de recharger
                setTimeout(() => {
                    if (confirm('Nettoyage termin√©. Recharger la page maintenant ?')) {
                        window.location.reload();
                    }
                }, 2000);

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur nettoyage caches : ${error.message}</div>`;
            }
        }

        // 10. Reset d'urgence complet
        function emergencyReset() {
            if (!confirm('üö® RESET D\'URGENCE üö®\n\nCette action va :\n- Vider tous les caches\n- Supprimer toutes les donn√©es locales\n- Recharger la page\n\nContinuer ?')) {
                return;
            }

            const resultsDiv = document.getElementById('auto-fix-results');
            resultsDiv.innerHTML = '<div class="status error">üö® Reset d\'urgence en cours...</div>';

            try {
                // Tout nettoyer
                localStorage.clear();
                sessionStorage.clear();
                
                // Nettoyer les caches
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }

                resultsDiv.innerHTML = '<div class="status success">‚úÖ Reset termin√© - Rechargement...</div>';
                
                // Recharger apr√®s un d√©lai
                setTimeout(() => {
                    window.location.href = window.location.origin + '?reset=' + Date.now();
                }, 2000);

            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Erreur reset : ${error.message}</div>`;
            }
        }

        // 11. Exporter les donn√©es de diagnostic
        function exportDiagnosticData() {
            try {
                const report = `
RAPPORT DE DIAGNOSTIC TECHNIQUE - CERCLE PRIV√â
=============================================

Date: ${new Date().toLocaleString('fr-FR')}
URL: ${window.location.href}
Navigateur: ${navigator.userAgent}

INFORMATIONS SYST√àME:
${JSON.stringify(diagnosticData.systemInfo, null, 2)}

ERREURS D√âTECT√âES:
${diagnosticData.errors.map((error, i) => `${i+1}. ${error}`).join('\n')}

R√âPARATIONS APPLIQU√âES:
${diagnosticData.fixes.map((fix, i) => `${i+1}. ${fix}`).join('\n')}

RECOMMANDATIONS:
${diagnosticData.errors.length === 0 ? 
  '‚úÖ Le syst√®me fonctionne correctement' : 
  '‚ö†Ô∏è Contactez le support technique avec ce rapport'
}

ACTIONS SUGG√âR√âES:
1. V√©rifier la console JavaScript (F12)
2. Tester en navigation priv√©e
3. Vider le cache du navigateur
4. V√©rifier la connexion internet
5. Contacter nicolas.c@lacremerie.fr si le probl√®me persiste
                `;

                const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `diagnostic-cercle-prive-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                
                URL.revokeObjectURL(url);
                
                document.getElementById('auto-fix-results').innerHTML = 
                    '<div class="status success">‚úÖ Rapport export√© - Envoyez ce fichier au support technique</div>';

            } catch (error) {
                document.getElementById('auto-fix-results').innerHTML = 
                    `<div class="status error">‚ùå Erreur export : ${error.message}</div>`;
            }
        }

        // Initialisation automatique
        window.addEventListener('load', () => {
            console.log('üîß Diagnostic technique charg√©');
            initializeSystemInfo();
            
            // Auto-diagnostic apr√®s 2 secondes
            setTimeout(() => {
                runComprehensiveDiagnostic();
            }, 2000);
        });

        // Capturer les erreurs en temps r√©el
        window.addEventListener('error', (event) => {
            diagnosticData.errors.push({
                type: 'javascript',
                message: event.error?.message || event.message,
                filename: event.filename,
                lineno: event.lineno,
                timestamp: new Date().toISOString()
            });
        });

        window.addEventListener('unhandledrejection', (event) => {
            diagnosticData.errors.push({
                type: 'promise',
                reason: event.reason?.toString() || 'Unknown rejection',
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html>